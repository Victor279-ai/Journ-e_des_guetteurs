<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>JournÃ©e des Guetteurs â€“ TÃ©moignage</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    font-family: Arial, sans-serif;
    background: #f2f2f2;
    text-align: center;
    margin: 0;
    padding: 15px;
}

.container {
    position: relative;
    max-width: 420px;
    margin: auto;
}

#affiche {
    width: 100%;
    border-radius: 12px;
}

/* Cercle vidÃ©o */
#videoCircle {
    position: absolute;
    top: 43%;
    left: 33%;
    transform: translate(-50%, -50%);
    width: 210px;
    height: 210px;
    border-radius: 50%;
    overflow: hidden;
    background: black;
    display: none;
}

#videoCircle video {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

button {
    margin-top: 15px;
    padding: 12px 20px;
    font-size: 16px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
}

#recordBtn {
    background: #1a73e8;
    color: white;
}

#downloadBtn {
    background: #188038;
    color: white;
    display: none;
}
</style>
</head>

<body>

<h3>ðŸŽ¥ TÃ©moignage â€“ JournÃ©e des Guetteurs</h3>

<div class="container">
    <img src="affiche.png" id="affiche">

    <div id="videoCircle">
        <!-- VidÃ©o en direct -->
        <video id="videoLive" autoplay muted></video>
    </div>
</div>

<button id="recordBtn">ðŸŽ¥ Enregistrer mon tÃ©moignage (15s)</button>
<button id="downloadBtn">ðŸ“¥ TÃ©lÃ©charger ma vidÃ©o</button>

<script>
let mediaRecorder;
let recordedChunks = [];
let recordedBlob;

const videoCircle = document.getElementById("videoCircle");
const videoLive = document.getElementById("videoLive");
const recordBtn = document.getElementById("recordBtn");
const downloadBtn = document.getElementById("downloadBtn");

recordBtn.onclick = async () => {

    // ðŸŽ¥ CamÃ©ra en direct
    const stream = await navigator.mediaDevices.getUserMedia({
        video: true,
        audio: true
    });

    // Afficher directement la camÃ©ra dans le cercle
    videoLive.srcObject = stream;
    videoCircle.style.display = "block";

    // ðŸŽ¬ Enregistrement
    mediaRecorder = new MediaRecorder(stream);
    recordedChunks = [];

    mediaRecorder.ondataavailable = e => {
        if (e.data.size > 0) recordedChunks.push(e.data);
    };

    mediaRecorder.onstop = () => {

        // CrÃ©er le fichier vidÃ©o final
        recordedBlob = new Blob(recordedChunks, {
            type: "video/webm"
        });

        // Stop camÃ©ra
        stream.getTracks().forEach(track => track.stop());

        // Activer bouton tÃ©lÃ©chargement
        downloadBtn.style.display = "inline-block";
        recordBtn.innerText = "âœ… VidÃ©o enregistrÃ©e !";
    };

    mediaRecorder.start();

    // Stop aprÃ¨s 15 secondes
    setTimeout(() => {
        mediaRecorder.stop();
    }, 15000);
};


// ðŸ“¥ TÃ©lÃ©charger la vidÃ©o directement
downloadBtn.onclick = () => {

    const url = URL.createObjectURL(recordedBlob);

    const link = document.createElement("a");
    link.href = url;
    link.download = "temoignage-guetteurs.webm";
    link.click();
};
</script>

</body>
</html>
