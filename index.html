<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>JournÃ©e des Guetteurs â€“ TÃ©moignage</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    font-family: Arial, sans-serif;
    background: #f2f2f2;
    text-align: center;
    margin: 0;
    padding: 15px;
}

.container {
    position: relative;
    max-width: 420px;
    margin: auto;
}

#affiche {
    width: 100%;
    border-radius: 12px;
}

/* âœ… Cercle vidÃ©o placÃ© sur lâ€™assemblÃ©e */
#videoCircle {
    position: absolute;
    top: 43%;
    left: 33%;
    transform: translate(-50%, -50%);

    width: 210px;
    height: 210px;

    border-radius: 50%;
    overflow: hidden;
    background: black;
    display: none;
}

#videoCircle video {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

/* Boutons */
button {
    margin-top: 15px;
    padding: 12px 20px;
    font-size: 16px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
}

#recordBtn {
    background: #1a73e8;
    color: white;
}

#downloadBtn {
    background: #188038;
    color: white;
    display: none;
}
</style>
</head>

<body>

<h3>ðŸŽ¥ TÃ©moignage â€“ JournÃ©e des Guetteurs</h3>

<div class="container" id="captureZone">
    <img src="affiche.png" id="affiche">

    <div id="videoCircle">
        <video id="videoPlayback" autoplay muted loop></video>
    </div>
</div>

<button id="recordBtn">ðŸŽ¥ Cliquer pour faire la vidÃ©o (15s)</button>
<button id="downloadBtn">ðŸ“¥ TÃ©lÃ©charger mon affiche vidÃ©o</button>

<script>
let mediaRecorder;
let recordedChunks = [];
const videoCircle = document.getElementById("videoCircle");
const videoPlayback = document.getElementById("videoPlayback");

document.getElementById("recordBtn").onclick = async () => {
    const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
    mediaRecorder = new MediaRecorder(stream);
    recordedChunks = [];

    mediaRecorder.ondataavailable = e => recordedChunks.push(e.data);

    mediaRecorder.onstop = () => {
        const blob = new Blob(recordedChunks, { type: "video/webm" });
        videoPlayback.src = URL.createObjectURL(blob);
        videoCircle.style.display = "block";
        document.getElementById("downloadBtn").style.display = "inline-block";
    };

    mediaRecorder.start();
    setTimeout(() => mediaRecorder.stop(), 15000);
};

document.getElementById("downloadBtn").onclick = async () => {
    const canvas = document.createElement("canvas");
    const container = document.getElementById("captureZone");
    canvas.width = container.offsetWidth;
    canvas.height = container.offsetHeight;

    const ctx = canvas.getContext("2d");
    const img = document.getElementById("affiche");

    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

    const video = videoPlayback;

    /* âœ… Cercle exactement sur l'assemblÃ©e */
    const circleX = canvas.width * 0.33;
    const circleY = canvas.height * 0.43;
    const radius = 105;

    ctx.save();
    ctx.beginPath();
    ctx.arc(circleX, circleY, radius, 0, Math.PI * 2);
    ctx.clip();

    ctx.drawImage(video,
        circleX - radius,
        circleY - radius,
        radius * 2,
        radius * 2
    );

    ctx.restore();

    const link = document.createElement("a");
    link.download = "affiche-video-guetteurs.png";
    link.href = canvas.toDataURL("image/png");
    link.click();
};
</script>

</body>
</html>